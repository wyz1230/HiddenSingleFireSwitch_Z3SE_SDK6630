////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//  WjCryptLib_MD5
//
//  Implementation of MD5 hash function. Originally written by Alexander Peslyak. Modified by WaterJuice retaining
//  Public Domain license.
//
//  This is free and unencumbered software released into the public domain - June 2013 waterjuice.org
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

#pragma once

////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//  IMPORTS
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

#include <stdint.h>
#include <stdio.h>

////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//  TYPES
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

// MD5Context - This must be initialised using MD5Initialised. Do not modify the contents of this structure directly.
typedef struct
{
    uint32_t     lo;
    uint32_t     hi;
    uint32_t     a;
    uint32_t     b;
    uint32_t     c;
    uint32_t     d;
    uint8_t      buffer[64];
    uint32_t     block[16];
} MD5Context;

#define MD5_HASH_SIZE           ( 128 / 8 )

typedef struct
{
    uint8_t      bytes [MD5_HASH_SIZE];
} MD5_HASH;

////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//  PUBLIC FUNCTIONS
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//  MD5Initialise
//
//  Initialises an MD5 Context. Use this to initialise/reset a context.
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
void MD5Initialise (
						MD5Context*         Context         // [out]
				    );

////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//  MD5Update
//
//  Adds data to the MD5 context. This will process the data and update the internal state of the context. Keep on
//  calling this function until all the data has been added. Then call MD5Finalise to calculate the hash.
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
void MD5Update (
					MD5Context*         Context,        // [in out]
					void const*         Buffer,         // [in]
					uint32_t            BufferSize      // [in]
				);

////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//  MD5Finalise
//
//  Performs the final calculation of the hash and returns the digest (16 byte buffer containing 128bit hash). After
//  calling this, MD5Initialised must be used to reuse the context.
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
void MD5Finalise (
					MD5Context*         Context,        // [in out]
					MD5_HASH*           Digest          // [in]
				 );

////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//  MD5Calculate
//
//  Combines MD5Initialise, MD5Update, and MD5Finalise into one function. Calculates the MD5 hash of the buffer.
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
void MD5Calculate (
						void  const*        Buffer,         // [in]
						uint32_t            BufferSize,     // [in]
						MD5_HASH*           Digest          // [in]
				   );
